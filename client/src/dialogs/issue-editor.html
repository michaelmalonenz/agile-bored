<template>
  <ux-dialog class="issue-editor">
    <ux-dialog-header>
      <h2>${heading}</h2>
    </ux-dialog-header>
    <ux-dialog-body>
      <div class="row">
        <div class="col-8">
          <input type="text" class="edit-issue-title form-control" value.bind="issue.title" placeholder="title" attach-focus.bind="!edit" />
        </div>
        <div class="col-2">
          <autocomplete show.bind="!subtask"
            value.bind="issue.epic.key"
            search.call="epicSearch(value)" placeholder="Epic"
            compact="true" selected.bind="issue.epic"
            view="/issues/autocomplete-epic.html"></autocomplete>
        </div>
        <div class="col-2">
          <div class="edit-control pull-right">
            <select-dropdown value.bind="issue.issueType" options.bind="issueTypes"></select-dropdown>
          </div>
        </div>
      </div>
      <div class="edit-issue-content">
        <div class="row h-100">
          <div class="${edit ? 'col-md-9' : 'col-md-12'} h-100">
            <viewing-text-editor if.bind="currentTab == 'description'" start-as-edit.bind="!edit" value.bind="issue.description" placeholder="description"></viewing-text-editor>
            <comments-list if.bind="currentTab == 'comments'" issue-id.bind="issue.id" comments.bind="issue.comments"></comments-list>
            <sub-task-list if.bind="currentTab == 'sub-tasks'" issues.bind="issue.children" issue-id.bind="issue.id"></sub-task-list>
          </div>
          <div class="col-md-3 h-100" if.bind="edit">
            <div class="row vertically-center-row">
              <div class="col-4 text-right">Reporter: </div>
              <div class="col-8">${issue.reporter.displayName & oneTime}</div>
            </div>
            <div class="row vertically-center-row">
              <div class="col-4 text-right">Assignee: </div>
              <div class="col-8">${issue.assignee.displayName & oneTime}</div>
            </div>
            <div class="row vertically-center-row">
                <div class="col-4 text-right">Created: </div>
                <div class="col-8 date-format">${issue.createdAt | date & oneTime}</div>
              </div>
            <div class="row vertically-center-row">
              <div class="col-4 text-right">Updated: </div>
              <div class="col-8 date-format">${issue.updatedAt | date & oneTime}</div>
            </div>
          </div>
        </div>
      </div>
    </ux-dialog-body>

    <ux-dialog-footer>
      <div class="row">
        <div class="col-8 ${edit ? 'visible' : 'invisible'}">
            <button type="button" class="btn btn-primary" click.trigger="setTab('description')">Description</button>
            <button type="button" class="btn btn-primary" click.trigger="setTab('comments')">Comments</button>
            <button if.bind="!subtask" type="button" class="btn btn-primary" click.trigger="setTab('sub-tasks')">Sub Tasks</button>
            <button type="button" class="btn btn-primary" click.trigger="setTab('history')">History</button>
        </div>
        <div class="col-4" if.bind="isModified">
          <button type="button" class="btn btn-outline-secondary" click.trigger="controller.cancel()">Cancel</button>
          <button type="button" class="btn btn-primary" click.trigger="save()">Save</button>
        </div>
        <div class="col-2 offset-2" if.bind="!isModified">
          <button type="button" class="btn btn-outline-secondary" click.trigger="controller.cancel()">Close</button>
        </div>
      </div>
    </ux-dialog-footer>
  </ux-dialog>
</template>
