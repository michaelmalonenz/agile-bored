<template>
  <ux-dialog class="issue-editor">
    <ux-dialog-header>
      <h2>${heading}</h2>
    </ux-dialog-header>
    <ux-dialog-body>
      <div class="row">
        <div class="col-8">
          <input type="text" class="edit-issue-title form-control" value.bind="issue.title" placeholder="title" attach-focus.bind="!edit" />
        </div>
        <div class="col-2">
          <autocomplete show.bind="!subtask"
            value.bind="issue.epic.key"
            search.call="epicSearch(value)" placeholder="Epic"
            compact="true" selected.bind="issue.epic"
            view="/issues/autocomplete-epic.html"></autocomplete>
        </div>
        <div class="col-2">
          <div class="edit-control pull-right">
            <select-dropdown value.bind="issue.issueType" options.bind="issueTypes"></select-dropdown>
          </div>
        </div>
      </div>
      <div class="edit-issue-content row">
        <div class="${edit ? 'col-md-8' : 'col-md-12'} h-100">
          <viewing-text-editor if.bind="currentTab === 'description'" start-as-edit.bind="!edit" value.bind="issue.description" placeholder="description"></viewing-text-editor>
          <comments-list if.bind="currentTab === 'comments'" issue-id.bind="issue.id" comments.bind="issue.comments"></comments-list>
          <sub-task-list if.bind="currentTab === 'sub-tasks'" issues.bind="issue.children" issue-id.bind="issue.id"></sub-task-list>
          <changelog-display if.bind="currentTab === 'history'" issue-id.bind="issue.id"></changelog-display>
        </div>
        <div class="col-md-4 h-100" if.bind="edit">
          <div class="row vertically-center-row">
            <div class="col-3 text-right">Reporter: </div>
            <div class="col-9"><user-display user.bind="issue.reporter"></user-display></div>
          </div>
          <div class="row vertically-center-row">
            <div class="col-3 text-right">Assignee: </div>
            <div class="col-9"><user-display user.bind="issue.assignee"></user-display></div>
          </div>
          <div class="row vertically-center-row">
              <div class="col-3 text-right">Created: </div>
              <div class="col-9 date-format">${issue.createdAt | date & oneTime}</div>
            </div>
          <div class="row vertically-center-row">
            <div class="col-3 text-right">Updated: </div>
            <div class="col-9 date-format">${issue.updatedAt | date & oneTime}</div>
          </div>
        </div>
      </div>
    </ux-dialog-body>

    <ux-dialog-footer>
      <div class="row">
        <div class="col-8 ${edit ? 'visible' : 'invisible'} tab-controls">
            <div class="tab-control ${currentTab === 'description' ? 'active' : ''}" click.trigger="setTab('description')">
              <i class="fa fa-book"></i>&nbsp; Description
            </div>
            <div class="tab-control ${currentTab === 'comments' ? 'active' : ''}" click.trigger="setTab('comments')">
              <i class="fa fa-comments"></i>&nbsp; Comments
            </div>
            <div if.bind="!subtask" class="tab-control ${currentTab === 'sub-tasks' ? 'active' : ''}" click.trigger="setTab('sub-tasks')">
              <i class="fa fa-sitemap"></i>&nbsp; Sub Tasks
            </div>
            <div class="tab-control ${currentTab === 'history' ? 'active' : ''}" click.trigger="setTab('history')">
              <i class="fa fa-clock"></i>&nbsp; History
            </div>
        </div>
        <div class="col-4" if.bind="isModified">
          <button type="button" class="btn btn-outline-secondary" click.trigger="controller.cancel()">Cancel</button>
          <button type="button" class="btn btn-primary" click.trigger="save()">Save</button>
        </div>
        <div class="col-2 offset-2" if.bind="!isModified">
          <button type="button" class="btn btn-outline-secondary" click.trigger="controller.cancel()">Close</button>
        </div>
      </div>
    </ux-dialog-footer>
  </ux-dialog>
</template>
